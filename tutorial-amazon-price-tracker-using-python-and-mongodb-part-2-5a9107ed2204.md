Unknown markup type 10 { type: [33m10[39m, start: [33m73[39m, end: [33m78[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m83[39m, end: [33m93[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m13[39m, end: [33m23[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m46[39m, end: [33m51[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m0[39m, end: [33m7[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m41[39m, end: [33m49[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m44[39m, end: [33m50[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m0[39m, end: [33m6[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m195[39m, end: [33m199[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m0[39m, end: [33m9[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m67[39m, end: [33m71[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m73[39m, end: [33m78[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m80[39m, end: [33m84[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m86[39m, end: [33m89[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m94[39m, end: [33m98[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m111[39m, end: [33m119[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m26[39m, end: [33m30[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m41[39m, end: [33m45[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m64[39m, end: [33m71[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m14[39m, end: [33m17[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m13[39m, end: [33m25[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m44[39m, end: [33m48[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m28[39m, end: [33m32[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m103[39m, end: [33m107[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m51[39m, end: [33m55[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m9[39m, end: [33m19[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m24[39m, end: [33m29[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m59[39m, end: [33m69[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m85[39m, end: [33m95[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m7[39m, end: [33m9[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m14[39m, end: [33m21[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m30[39m, end: [33m37[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m87[39m, end: [33m97[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m102[39m, end: [33m107[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m101[39m, end: [33m125[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m144[39m, end: [33m147[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m153[39m, end: [33m160[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m50[39m, end: [33m74[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m78[39m, end: [33m82[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m9[39m, end: [33m13[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m66[39m, end: [33m76[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m13[39m, end: [33m17[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m32[39m, end: [33m60[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m74[39m, end: [33m78[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m82[39m, end: [33m87[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m99[39m, end: [33m103[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m144[39m, end: [33m149[39m }
Unknown markup type 10 { type: [33m10[39m, start: [33m38[39m, end: [33m45[39m }

# Tutorial: Amazon price tracker using Python and MongoDB (Part 2)

A two-part tutorial on how to create Amazon price tracker

![Photo by [Austin Distel](https://unsplash.com/@austindistel?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)](https://cdn-images-1.medium.com/max/12668/0*S8OCj7ncb7kD2tZg)*Photo by [Austin Distel](https://unsplash.com/@austindistel?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)*
> If you are new then please visit part 1 of the tutorial, click [**here](https://medium.com/@deeprajpradhan/tutorial-amazon-price-tracker-using-python-and-mongodb-part-1-aece6347ec63)**.

Hello there, and welcome to the part 2 tutorial of Amazon price tracker using Python and MongoDB. In this part of the tutorial, we will learn how to store the data that we extracted from the Amazon product page.

### Step 1: Creating some files for the project

Open the project folder where you have your code from part 1 then create db.py and tracker.py.

I’ll explain tracker.py later on for now open db.py which is where we will code to store and retrieve the data to/from the database.

Now, import some libraries that are required.

    import datetime
    import pymongo

pymongo is for connecting to MongoDB and datetime is to get a timestamp.

Next, we will connect to MongoDB and select amazon as our database

    client = pymongo.MongoClient("mongodb://localhost:27017/")
    db = client["amazon"]
> **Note**: you may want to have [NoSQLBooster](https://nosqlbooster.com/downloads) or [MongoDB Compass](https://www.mongodb.com/products/compass) as an interface to monitor or modify the database easily since they are GUI based software.

### Step 2: Create a function to add product details to the database

OK so before we begin let us look at the structure or format of how we will store the details.

We will have a **collection**(a table in SQL terms, read [***here](https://www.tutorialspoint.com/mongodb/mongodb_overview.htm)***)for products and each product will be a **document**(a tuple in SQL terms, read [***here](https://www.tutorialspoint.com/mongodb/mongodb_overview.htm)***).

Here is an example of a **document.**

<iframe src="https://medium.com/media/e20edd3ab46baa7f1506292c89651e5c" frameborder=0></iframe>

‘asin’ is the Amazon Standard Identification Number. It is a set of 10 digit alphanumeric characters that is unique to each product. Example, in this URL [*https://www.amazon.in/dp/B077Q42J3 2](https://www.amazon.in/dp/B077Q42J32) *the asin is the last part ***B077Q42J3***

‘details’ is an array of a dictionary and each dictionary contains name, price, deal, url and date for a product.

    {
      'name': 'Nokia 8.1 (Iron, 4GB RAM, 64GB Storage)',
      'price': 19026.0,
      'deal': False,
      'url': 'https://www.amazon.in/dp/B077Q42J32',
      'date': datetime.datetime(2019, 8, 9, 19, 20, 30, 858904)
    }

Let us look at the function now.

<iframe src="https://medium.com/media/93764b976dadb4091c5d0bf5f4a257fc" frameborder=0></iframe>

The first thing that we do in the function is to select the collection in the MongoDB in this case, it will be products.

    new = db["products"]

Next, we will extract the asin from the URL

    ASIN = details["url"][len(details["url"])-10:len(details["url"])]

After that, add a timestamp with the key date in the dictionary details.

    details["date"] = datetime.datetime.utcnow()

Now comes the try block, where we store the data in the database.

    new.update_one(
        {                
            "asin":ASIN
        },
        {
            "$set": 
            {
                "asin":ASIN
            },
            "$push":
            {
                "details":details
            }
        },             
        upsert=True
    )

The function update_one() is divided into three parts

    {
        "asin":ASIN
    } 

The first part of the function searches for asin

    {
        "$set": 
        {
            "asin":ASIN
        },
        "$push":
        {
            "details":details
        }
    }

The second part updates the asin and adds the data to the array of data.

    upsert=True

The third part is a condition when it’s set to true, creates a new document if the search doesn’t find asin else it just updates it.

### Step 3: Create a function to retrieve data from the database

We may need to retrieve the data that is stored in the database to build an excel sheet or visualize the data or any other thing that you may think. Now let us begin to code the function.

<iframe src="https://medium.com/media/a2585e36159a02d99460de54e1cf1ea2" frameborder=0></iframe>

This function would find the document based on the asin. The output from this would be something like this.

<iframe src="https://medium.com/media/e20edd3ab46baa7f1506292c89651e5c" frameborder=0></iframe>

### Step 4: Creating the driver program

Now that scraper.py and db.py are done, it is time to make tracker.py. Open the file tracker.py that we had created earlier.

Import db and scraper as we need to combine the functions that we had created earlier and also import time library.

    import db
    import scraper
    import time

Next, specify the URL

    URL = "https://www.amazon.in/dp/B077Q42J32/"

Now, let us create a function track() that's where we would combine the functions from scraper.py and db.py to get the data from the website and push it to the database.

The first thing to do inside the function is to get the details, you do that by calling the function get_product_details(URL) with the argument URL from scraper

    details = scraper.get_product_details(URL)

Now check if the details returned by the function get_product_details(URL) is None or not.

If it is None that means something is wrong and we have to return “not done”.

    if details is None:        
        result = "not done"

If it is not None then push the details to the database.

    else:        
        inserted = db.add_product_detail(details)

Now again check if the function add_product_details(details) has returned True or False. Returning True would mean it is inserted and returning False would mean data was not stored in the database.

    if inserted:            
        result = "done"        
    else:            
        result = "not done"
    return result

The last part is to call the function track() every 1 minute or 60 seconds or change it depending on your requirement.
> **Note**: You **should not** do it** every second,** doing so you would cross the rate limit and **amazon will block you** meaning you will not be able to scrap the data.

    while True:    
        print(track())    
        time.sleep(60)

Here is the complete code.

<iframe src="https://medium.com/media/acd44acd2800c49461c97e7ec604f416" frameborder=0></iframe>
> **Note**: Also you should rotate your user-agent as amazon may put a hard rate limit of 1 request per minute on you. For more information on how to do that check [**here](https://www.scrapehero.com/how-to-fake-and-rotate-user-agents-using-python-3/)**.

Go and check your GUI based software, you should see something like this.

![](https://cdn-images-1.medium.com/max/2000/1*APUx7dNS0iN2UDaKZfL2eg.png)

### It is done, now what?

Finally, the tutorial is over, now you can do one of many things

* Let the program run on AWS cloud.

* Do some machine learning with the data.

* Visualize the data as it increases and decreases over time.
> # I'm sure that you can do lots of things with the data, the limit lies in your imagination😄 Hope this tutorial was of help to you all. See you in the next one ✌️

*Find the complete source code for this article below.*
[**ArticB/amazon_price_tracker**
*amazon_price_tracker-An amazon price tracker using Python and MongoDB*github.com](https://github.com/ArticB/amazon_price_tracker)
